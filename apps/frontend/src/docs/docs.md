# Заметки.
Это обрывки заметок из которых потом можно будет что-то слепить


## Замена в текстах для отправки в группы.

30.03. Сегодня добавлял замены в текстах которыми бот отвечает.

***Замены у всех ботов разные.***


__По клиенту__


это включено сейчас для всех текстов (заменяется везде)

если в тексте найдено \#\# то будет начат поиск замен. замены пишутся в формате \#\#текст_замены\#\# и затем заменяются значениями из массива которые соответствуют тексту **текст_замены**

 **Если замены не существет, то генерируется пустое сообщение, чтобы предотвратить отправку ключей замены.**

__А что у нас с UI?__

 предпросмотр есть в юае, если среди вариантов ответа есть хотя бы один содержащий текст \#\#  но небольшой баг, все замены не делаются за раз, а только одна. Сами боты заменяют все найденные вхождения.

 пришлось быстро писать.

 инпуты не подписал - первый это ключ, второй это значение которое надо добавить.

 если введённого ключа не существует, то он создастся при клике на кнопку *создать*.

иногда что-то багует но вцелом вроде работает.

__И сервер__


__Надо перезапустить ботов чтобы применились изменения!!!__

На сервере есть эндпоинт для получения списка. По состоянию на 30.03 из круда только Р



## Добавление нового списка документации

Есть компонент ``components\HelpButton.tsx`` и у него есть пропы path и опциональный hint. Path можно взять из id элемента прямо из инспектора этой странички у любого заголовка, ему проставляется id эквивалентный тексту этого заголовка с заменёнными пробелами на символы тире.

Проп Hint нужен для опциональной подсказки

Опционально выводятся дети.

## Таблица банов бота

В процессе работы в группах бота банят и он записывает это.

__важный момент:__

__таблица обновляется только по случаю неудачи отправки сообщения в группу__

колонки таковы:

- Чат:

    Это название чата, какое оно в телеге. При клике на название открывается этот чат в клиенте телеги, установленном в системе по умолчанию

- Разбан:

    Легко читаемый вариант представления времени, оставшегося до разбана.

- Осталось:

    Более точное представление этого времени.

- Обновлено:

    Самая важная колонка. Это время, когда бот последний раз в этой группе пытался отправить сообщение и у него не получилось. __Если это было давно и траффик в чате большой, то бота, вероятно, разбанили__

- Категория:

    Категории бывают forbidden И banned. В чём разница предстоит узнать.


## Cоздание бота




1. Покупка номера.
2. Регистрация нового аккаунта. Тут нужно указать username и добавить бота в группы report и training.
3. Заходим на my.telegram.org и регаем API.
    1. Включить VPN.
    2. Ввести username в таком виде, чтобы его приняла форма.
    3. Отметить галочкой Desktop.
4. Создаём папку бота.
    1. Переходим на botplatform и открываем работающего бота.
    2. Вкладка создать бота
    3. Пишем точно такой же username как у бота.
    4. Подставляем api_id и api_hash из my.telegram.org
    5. В from_folder выбираем последнего созданного бота (из ранних ботов может не получится создать)
5. Привязка бота.
    1. Идём в терминал.
    2. Переходим в папку бота по пути telethon/whores
    3. python ./main.py
    4. Вводим номер телефона
    5. Вводим код из лс.
6. Отправка боту сообщений инициализации. На этом этапе бот настраивается получая правильные сообщения.
    1. пишем боту в лс genesys
    2. Отправляем сообщения в правильном формате.

Правильный формат сообщений.

первое сообщение (всё с новой строки без пропусков, как тут):

<картинка>

\_setup\_

Имя (Фамилия)

текст описания

Каждая следующая картинка с текстом обновляет аватарку (текст не учитывается).
второе сообщение:

<картинка> + любой текст

Бот работает. Можно добавлять в группы. Опционально _увеличить_ group_messages_max=confi=<number> в тренинг

__как эта операция работает?__

Конкретно та операция создаёт бота на сервере, копируя содержимое папки существующего бота. Чтобы создать бота нужно выбрать из папки существующего.

Удаляется только папка логов. Конфиг заменяется даными из запроса. Весь конфиг остаётся прежним кроме полей, переданных в запросе.

Хз зачем там from_folder но пусть будет, лень убирать)

Если настроить условную отправку полей (__не полей с нулевыми значениями!!__) то можно устанавливать кастомные конфиги ботанам.

## Последовательность для спама


Это спам, который отправляется в группу каждые ``group_messages_max`` +- 100 сообщений. ``group_messages_max`` устанавливается в конфиге.

Контролами UI можно фильтровать спамы, удалять их нажав кнопку минуса рядом с текстом и добавлять новый спам, нажатием ``Enter`` в поле фильтрации.

# Прочие_вещи.
тут какой-то текст

## Как добавить новый бот в группу?

1. Пишем боту в лс genesys

